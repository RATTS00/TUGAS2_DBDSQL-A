create database PENJUALANDVD;
use PENJUALANDVD;

CREATE TABLE MOVIE (
	KODE_DVD VARCHAR(10),
	JUDUL VARCHAR(60),
	HARGA_SEWA DOUBLE,
	DENDA DOUBLE,
	TAHUN_RILIS SMALLINT,
	PRIMARY KEY (KODE_DVD)
);

CREATE TABLE GENRE (
	ID_GENRE SMALLINT,
	GENRE VARCHAR(45),
	PRIMARY KEY (ID_GENRE)
);

CREATE TABLE KECAMATAN (
	ID_KECAMATAN SMALLINT,
	KECEMATAN VARCHAR(45),
	PRIMARY KEY (ID_KECAMATAN)
);

CREATE TABLE KELURAHAN (
	ID_KELURAHAN SMALLINT,
	ID_KECAMATAN SMALLINT,
	KELURAHAN VARCHAR(45),
	PRIMARY KEY (ID_KELURAHAN),
	FOREIGN KEY (ID_KECAMATAN) REFERENCES KECAMATAN (ID_KECAMATAN)
);

CREATE TABLE GENRE_MOVIE (
	ID_GENRE SMALLINT,
	KODE_DVD VARCHAR(10),
	FOREIGN KEY (ID_GENRE) REFERENCES GENRE (ID_GENRE),
	FOREIGN KEY (KODE_DVD) REFERENCES MOVIE (KODE_DVD)
);

CREATE TABLE PELANGGAN (
    KODE_PELANGGAN VARCHAR(10),
    ID_KELURAHAN SMALLINT,
    NAMA VARCHAR(45),
    ALAMAT VARCHAR(60),
    JENIS_KELAMIN CHAR(1),
    PRIMARY KEY (KODE_PELANGGAN),
    FOREIGN KEY (ID_KELURAHAN) REFERENCES KELURAHAN (ID_KELURAHAN),
    CONSTRAINT CK_JENIS_KELAMIN CHECK (JENIS_KELAMIN IN ('P', 'L'))
);

CREATE TABLE TRANSAKSI (
	TANGGAL_SEWA DATE,
	KODE_PELANGGAN VARCHAR(10),
	KODE_DVD VARCHAR(10),
	TANGGAL_WAJIB_KEMBALI DATE,
	TANGGAL_REALISASI_KEMBALI DATE,
	PRIMARY KEY (TANGGAL_SEWA),
	FOREIGN KEY (KODE_PELANGGAN) REFERENCES PELANGGAN (KODE_PELANGGAN),
	FOREIGN KEY (KODE_DVD) REFERENCES MOVIE (KODE_DVD)
);

CREATE TABLE KONTAK_PELANGGAN (
	KODE_PELANGGAN VARCHAR(10),
	NO_HP VARCHAR(25),
	UNIQUE INDEX KONTAK_PELANGGAN_UNIK1 (NO_HP),
	FOREIGN KEY (KODE_PELANGGAN) REFERENCES PELANGGAN (KODE_PELANGGAN)
);

ALTER TABLE MOVIE
MODIFY TAHUN_RILIS YEAR(4);

SHOW TABLES;
